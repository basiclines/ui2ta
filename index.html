<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />

		<title>Install UI2Takeaway</title>

		<!-- VIEWPORT TAGS -->
		<meta name = "viewport" content = "width = device-width, user-scalable =no" >
		<script type="text/javascript">
			// Nicely stolen from:
			// http://blog.margaretleibovic.com/post/42380607377/hacking-firefox-os-apps-with-github-pages
			// https://github.com/leibovic/mural/blob/master/js/mural.js#L30
			function checkInstalled() {
				var request = window.navigator.mozApps.getSelf();
				request.onsuccess = function getSelfSuccess() {
					// Bail if the app is already installed
					if (request.result) {
						document.body.dataset.installed = true;
						return;
					}

					var installButton = document.createElement('button');
					installButton.innerHTML = "Install UI2Takeaway";
					document.body.appendChild(installButton)
					installButton.addEventListener('click', installApp);
				};
				request.onerror = function getSelfError() {
					console.warn('error getting self: ' + request.error.name);
				};
			}

			function installApp() {
				var location = window.location.href;
				var manifest = location.substring(0, location.lastIndexOf('/')) + '/manifest.webapp';
				console.log('installApp: ' + manifest);

				var request = navigator.mozApps.install(manifest);
				request.onsuccess = function installSuccess() {
					console.log('success installing app: ' + request.result.manifest.name);
					document.body.dataset.installed = true;
				};
				request.onerror = function installError() {
					console.warn('error installing app: ' + request.error.name);
				};
			}

			document.addEventListener("DOMContentLoaded", function(){
				checkInstalled();
			});
		</script>
		<link rel="stylesheet" href="shared/style/buttons.css">
	</head>

	<body> <!-- Install button --> </body>
</html>
